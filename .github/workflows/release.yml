name: "Release App"


on:

  push:

    branches:

      - main

  workflow_dispatch: # Allows you to run this manually from the Actions tab


jobs:

  publish-tauri:

    permissions:

      contents: write

    strategy:

      fail-fast: false

      matrix:

        platform: [windows-latest, ubuntu-22.04]


    runs-on: ${{ matrix.platform }}

    steps:

      - uses: actions/checkout@v4


      - name: setup node

        uses: actions/setup-node@v4

        with:

          node-version: 20


      - name: install Rust stable

        uses: dtolnay/rust-toolchain@stable


      - name: install dependencies (ubuntu only)

        if: matrix.platform == 'ubuntu-22.04'

        run: |

          sudo apt-get update

          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.1-dev libayatana-appindicator3-dev librsvg2-dev


      - name: install frontend dependencies

        run: |

          npm install

          npm install @tailwindcss/postcss


      - uses: tauri-apps/tauri-action@v0

        env:

          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

        with:

          tagName: v0.1.0  # Hardcoded version to ensure it finds it

          releaseName: "ReqForge v0.1.0"

          releaseBody: "Automated build for Windows and Linux."

          releaseDraft: false # Change to false so it shows up immediately

          prerelease: false 
